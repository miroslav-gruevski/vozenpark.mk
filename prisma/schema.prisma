generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  language  String    @default("mk")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  vehicles  Vehicle[]
  reminders ReminderLog[]
}

model Vehicle {
  id                String    @id @default(cuid())
  userId            String
  // Vehicle Info
  vehicleType       String?   // car, suv, van, truck, motorcycle, other
  vehicleModel      String?
  year              Int?
  color             String?
  fuelType          String?   // petrol, diesel, electric, hybrid, lpg, other
  // Identification
  plate             String
  vin               String?
  // Assignment
  responsiblePerson String?
  // Purchase Details
  purchaseDate      DateTime?
  purchasePrice     Float?
  mileage           Int?
  // Expiry Dates
  regExpiry         DateTime
  insExpiry         DateTime
  inspExpiry        DateTime
  // Notes
  notes             String?
  // Timestamps
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  reminders         ReminderLog[]

  @@unique([userId, plate])
  @@index([userId])
}

model ReminderLog {
  id           String   @id @default(cuid())
  userId       String
  vehicleId    String
  reminderType String   // "30d", "7d", "1d", "0d"
  expiryType   String   // "registration", "insurance", "inspection"
  sentAt       DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  vehicle      Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([vehicleId])
  @@unique([vehicleId, reminderType, expiryType])
}
